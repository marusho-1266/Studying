SYN Flood攻撃は、TCP/IPプロトコルスタックの**TCP（Transmission Control Protocol）**における**3ウェイハンドシェイク（Three-way Handshake）**の脆弱性を悪用した、古典的なサービス拒否（DoS）攻撃の一種です。

### TCPの3ウェイハンドシェイクとは？

まず、TCP接続が確立される際の基本的な手順である3ウェイハンドシェイクについて説明します。これは、クライアントとサーバーが信頼性の高い接続を確立するために行われる手順です。

1. SYN (Synchronize Sequence Numbers) - クライアントからサーバーへ:
    
    クライアントがサーバーに接続を要求するために、SYNフラグを立てたパケットを送信します。「接続を開始したい」という意図を伝えます。
    
2. SYN-ACK (Synchronize-Acknowledge) - サーバーからクライアントへ:
    
    SYNパケットを受信したサーバーは、接続要求を受け入れたことを示すSYNフラグと、クライアントのSYNパケットに対する確認応答（ACKフラグ）を立てたパケットをクライアントに返信します。このとき、サーバーはクライアントからの最終的な確認応答を待つため、接続待ちの状態（半開きの接続状態）でリソース（メモリなど）を確保します。
    
3. ACK (Acknowledge) - クライアントからサーバーへ:
    
    SYN-ACKパケットを受信したクライアントは、接続が確立されたことをサーバーに通知するためにACKフラグを立てたパケットを送信します。これにより、TCP接続が完全に確立され、データの送受信が可能になります。
    

### SYN Flood攻撃の仕組み

SYN Flood攻撃は、この3ウェイハンドシェイクの2番目のステップ（SYN-ACKの送信後、ACKの受信前）を悪用します。

1. 大量のSYNパケットの送信:
    
    攻撃者は、送信元IPアドレスを偽装（詐称）した大量のSYNパケットを標的のサーバーに送信します。偽装されたIPアドレスは、実際には存在しないアドレスや、応答を返さないアドレス（例：存在しないホスト、ファイヤーウォールでブロックされているホストなど）であることが多いです。
    
2. **サーバーのリソース枯渇:**
    
    - サーバーは、これらの大量のSYNパケットをそれぞれ正当な接続要求とみなし、SYN-ACKパケットを返信します。
        
    - その後、サーバーは偽装された送信元IPアドレスからの最終的なACKパケットを待ち続けます。しかし、送信元IPアドレスが偽装されているため、**ACKパケットは決して返ってきません**。
        
    - サーバーは、これらの「半開きの接続（half-open connection）」のために、接続待ちキューやメモリなどのリソースを確保し続けます。
        
    - 大量のSYNパケットが送りつけられると、サーバーの接続待ちキューがすぐに満杯になり、正当なユーザーからの新しい接続要求を受け付けられなくなります。
        
3. サービス拒否（DoS）状態:
    
    結果として、サーバーは正当なユーザーからの接続要求を処理できなくなり、サービスが停止したり、著しく応答が遅くなったりする「サービス拒否」状態に陥ります。
    

### SYN Flood攻撃の目的と影響

- **目的:** 標的のサーバーを過負荷にし、正当なユーザーがサービスを利用できないようにすること。
    
- **影響:** ウェブサイトの表示不能、メールサーバーの停止、オンラインゲームサーバーの機能停止など、TCP接続を必要とするあらゆるサービスに影響を与えます。
    

### 対策

SYN Flood攻撃に対する対策としては、以下のようなものがあります。

- SYNクッキー（SYN Cookies）:
    
    サーバーがSYN-ACKパケットを送信する際に、接続情報をサーバー側に保存せず、SYN-ACKパケットのシーケンス番号に暗号化された情報を埋め込みます。クライアントからACKパケットが返ってきたときに、その情報から接続を再構築するため、半開きの接続によるリソース消費を防ぎます。
    
- ファイアウォール/IPS（侵入防御システム）:
    
    異常なSYNパケットの増加を検知し、フィルタリングしたり、レートリミット（一定時間内のパケット数を制限）をかけたりします。
    
- 接続待ちキューの拡大:
    
    サーバーの接続待ちキューのサイズを増やすことで、一時的に攻撃に耐える能力を高めます。ただし、根本的な解決にはなりません。
    
- DDoS対策サービス:
    
    専門のDDoS対策サービス（クラウドベースのスクラビングサービスなど）を利用し、攻撃トラフィックを吸収・フィルタリングします。
    
- 送信元IPアドレスのフィルタリング（Ingress Filtering）:
    
    ISP（インターネットサービスプロバイダ）が、自社ネットワークから送信されるパケットの送信元IPアドレスが、そのネットワークに割り当てられたものでない場合に破棄するルールを設定することで、IPアドレス詐称されたパケットの流通を防ぎます。
    

SYN Flood攻撃は、TCP/IPの基本的な動作原理を悪用する代表的なDoS攻撃であり、現在でもDDoS攻撃の一環として利用されることがあります。
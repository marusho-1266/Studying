フラグメンテーション攻撃は、**IP（インターネットプロトコル）のフラグメンテーション（断片化）機能の脆弱性を悪用したDoS（サービス拒否）攻撃の一種**です。

### IPフラグメンテーションとは？

まず、IPフラグメンテーションの基本的な概念から説明します。

ネットワーク上を流れるデータは、通常「パケット」という単位で送受信されます。しかし、ネットワークの種類や経路上の中継機器（ルーターなど）によって、一度に送信できるパケットの最大サイズ（MTU: Maximum Transmission Unit）が異なります。

- 例えば、イーサネットのMTUは通常1500バイトです。
    
- もし、送信したいデータがこのMTUより大きい場合、IPプロトコルはデータをMTUサイズに合わせて複数の小さな「断片（フラグメント）」に分割します。これが「**フラグメンテーション**」です。
    
- 分割された各フラグメントには、元のパケットのどの部分であるかを示す情報（オフセット値など）や、どのパケットに属するかを示すIDなどが付加されます。
    
- 受信側では、これらのフラグメントをすべて受信した後、元の完全なパケットに再構築（再アセンブル）します。
    

### フラグメンテーション攻撃の仕組み

フラグメンテーション攻撃は、このパケットの分割・再構築のプロセスを悪用します。主な攻撃手法は以下の通りです。

1. 不正なフラグメントの送信:
    
    攻撃者は、不正な（あるいは誤解を招くような）フラグメントを標的のシステムに送信します。具体的には、以下のようなパケットが作成されます。
    
    - **オーバーラッピング（重複）フラグメント:**
        
        - 同じIDを持つフラグメントの中に、データ範囲が重複しているものを含めます。
            
        - 例えば、フラグメントAがデータ範囲0-100、フラグメントBがデータ範囲50-150のように、部分的に重なり合うようにします。
            
        - これは、受信側のシステムがパケットを再構築する際に、どちらのデータを優先すべきか混乱させ、処理に負荷をかけたり、エラーを引き起こしたりする可能性があります。
            
    - **不完全なフラグメントセット:**
        
        - 必要なフラグメントの一部を故意に送信しなかったり、最後のフラグメント（「これ以上フラグメントはない」ことを示すフラグが付いているもの）を送信しなかったりします。
            
        - 受信側のシステムは、すべてのフラグメントが揃うまで再構築プロセスを待機し続けるため、メモリやCPUなどのリソースが無駄に消費されます。
            
    - **無効なフラグメント情報:**
        
        - フラグメントオフセット値が不正であったり、パケット長がゼロであるなど、IPヘッダのフラグメンテーション情報に矛盾があるパケットを送信します。
            
        - これも受信側のシステムに不正な処理をさせ、エラーを引き起こしたり、クラッシュさせたりすることを狙います。
            
2. 標的システムのリソース枯渇またはクラッシュ:
    
    標的のシステムは、これらの不正なフラグメントを処理しようとして、以下のような影響を受けます。
    
    - **リソース（メモリ、CPU）の枯渇:** 不完全なパケットの再構築のために、メモリを確保し続けたり、不要な処理を繰り返したりすることで、システムリソースが消費されます。
        
    - **システムクラッシュ:** 不正なフラグメントの処理中に、ソフトウェアのバグを突かれ、システムがクラッシュしたり、再起動したりする可能性があります。
        
    - **ネットワーク性能の低下:** 再構築処理に負荷がかかり、正当な通信の処理が遅延する。
        

### 代表的なフラグメンテーション攻撃の種類

- **Ping of Death:**
    
    - 非常に大きなサイズのICMPエコー要求パケット（Ping）を、MTUよりも大きなサイズに設定して送信します。
        
    - このパケットは途中でフラグメント化されますが、再構築されたときにIPパケットの最大サイズ（65535バイト）を超過するよう細工します。
        
    - 過去の多くのOSやネットワーク機器は、この不正なパケットを処理しきれずにクラッシュしたりフリーズしたりしました。現在はほとんどのシステムで対策済みです。
        
- **Teardrop攻撃:**
    
    - 複数のIPフラグメントのオフセット値が矛盾している（重複している）パケットを送信します。
        
    - これを再構築しようとした際に、OSのバグを突いてシステムをクラッシュさせることができました。これも古い攻撃であり、現代のシステムでは対策されています。
        

### 対策

現代のOSやネットワーク機器は、基本的なフラグメンテーション攻撃（Ping of DeathやTeardropなど）に対してはほとんど対策が施されています。しかし、以下のような対策が一般的に有効です。

- **ファイアウォールによるフィルタリング:** 不正なIPフラグメントや、疑わしいフラグメントを含むパケットを検出・破棄するように設定します。
    
- **IDS/IPS（侵入検知/防御システム）:** 不正なパターンを持つパケットを検知し、ブロックします。
    
- **システムのアップデート:** OSやネットワーク機器のファームウェアを常に最新の状態に保ち、既知の脆弱性に対応します。
    
- **ネットワークデバイスの保護:** 不必要なフラグメンテーションを許可しない設定や、異常なフラグメントを検出する機能を有効にする。
    

フラグメンテーション攻撃は、特定のプロトコルの実装における「穴」を突くものであり、DDoS攻撃の一種として分類されます。